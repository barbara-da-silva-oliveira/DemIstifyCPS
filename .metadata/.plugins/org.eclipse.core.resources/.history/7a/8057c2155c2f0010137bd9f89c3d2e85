package fr.inria.kairos.influence.validation;

import org.eclipse.xtext.validation.Check;

import fr.inria.kairos.influence.metamodel.influenceMetamodel.Influence;
import fr.inria.kairos.influence.metamodel.influenceMetamodel.InfluenceMetamodel;
import fr.inria.kairos.influence.metamodel.influenceMetamodel.InfluenceMetamodelPackage;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class InfluenceDSLValidator extends AbstractInfluenceDSLValidator {

    private static final int MAX_IMPACTS = 2;

    @Check
    public void checkSourceArtifactImpact(InfluenceMetamodel model) {
        Map<String, Integer> impactCount = new HashMap<>();

        for (Influence inf : model.getOwnedInfluences()) {
            for (String src : inf.getSourceArtifact()) {
                impactCount.put(src, impactCount.getOrDefault(src, 0) + 1);
            }
        }

        for (Map.Entry<String, Integer> entry : impactCount.entrySet()) {
            if (entry.getValue() > MAX_IMPACTS) {
                warning(
                    "Artifact '" + entry.getKey() + "' is the source of " + entry.getValue() + " influences. C",
                    model,
                    null,
                    -1
                );
            }
        }
    }
    
    @Check
    public void checkChangeArtifact(Influence inf) {
        for (String src : inf.getSourceArtifact()) {
            for (String tgt : inf.getTargetArtifact()) {
            	info(
            			"If you modify artifact '" + src + "', you need to contact with the developer responsible for '" + tgt , inf, 
                        InfluenceMetamodelPackage.Literals.INFLUENCE__SOURCE_ARTIFACT
                    );

            }
        }
    }
}